<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q9729YZNBF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Q9729YZNBF');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>数羊 · Sheep Over Fence</title>
    <style>
        :root {
            --bg-color: #0A0E14;
            --duration: 3.5s;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--bg-color);
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        #world {
            position: relative;
            width: 100vw;
            height: 100vh;
            cursor: pointer;
            overflow: hidden;
        }

        /* 1. 巨大数字设计：更粗、更具呼吸感 */
        #counter {
            position: absolute;
            width: 100%;
            text-align: center;
            top: 35%;
            left: 0;
            font-size: 200px;
            font-weight: 900;
            letter-spacing: -5px;
            color: rgba(255, 255, 255, 0.08); /* 极低初始亮度 */
            transition: transform 4s ease, opacity 4s ease, top 5s ease;
            user-select: none;
            z-index: 1;
            pointer-events: none;
            animation: breathing 8s ease-in-out infinite;
        }

        @keyframes breathing {
            0%, 100% { transform: scale(1); opacity: 0.07; }
            50% { transform: scale(1.03); opacity: 0.12; }
        }

        /* 2. 栅栏：PNG 资源 */
        #fence {
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: auto;
            z-index: 10;
            opacity: 0.5;
            transition: opacity 5s ease;
            pointer-events: none;
        }

        /* 3. 羊的容器与动画逻辑 */
        .sheep-container {
            position: absolute;
            bottom: 25%;
            left: -120px;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 5;
            animation: moveRight var(--duration) linear forwards;
        }

        .sheep-image {
            width: 80px;
            height: auto;
            animation: jumpVertical var(--duration) linear forwards;
        }

        @keyframes moveRight {
            0% { left: -15%; }
            100% { left: 115%; }
        }

        @keyframes jumpVertical {
            0%, 15% { transform: translateY(0) rotate(0deg); }
            40% { transform: translateY(-120px) rotate(-10deg); }
            50% { transform: translateY(-135px) rotate(0deg); } /* 精准跨过 */
            60% { transform: translateY(-120px) rotate(10deg); }
            75% { transform: translateY(0) rotate(0deg); }
            82% { transform: translateY(3px) scaleY(0.85) rotate(2deg); } /* 困意低头 */
            92%, 100% { transform: translateY(0) scaleY(1); }
        }

        @media (max-width: 768px) {
            #counter { font-size: 140px; }
        }
    </style>
</head>
<body>

    <div id="world">
        <div id="counter">1</div>
        <img src="fence.png" id="fence" alt="fence">
    </div>

    <script>
        let realCount = 1;
        let displayCount = 1;
        let isPaused = false;
        
        // 音频设置
        const jumpSound = new Audio('jump.mp3');
        jumpSound.volume = 0.15;

        const counterEl = document.getElementById('counter');
        const fenceEl = document.getElementById('fence');
        const world = document.getElementById('world');

        function createSheep() {
            if (realCount > 300 || isPaused) return;

            const container = document.createElement('div');
            container.className = 'sheep-container';
            
            const img = document.createElement('img');
            img.src = 'sheep.png';
            img.className = 'sheep-image';
            
            container.appendChild(img);
            world.appendChild(container);

            // GA4 事件：羊跳跃
            if (typeof gtag === 'function') {
                gtag('event', 'sheep_jump', { 'value': realCount });
            }

            // 播放音频 (在跳跃中间点)
            setTimeout(() => {
                if (!isPaused) playSound();
            }, 1750);

            realCount++;

            // 时间模糊机制 (>=80次后 15% 概率视觉重复)
            if (realCount < 80 || Math.random() > 0.15) {
                displayCount = realCount;
            }

            applyDecayEffects();

            // 动画循环
            setTimeout(() => {
                container.remove();
                if (realCount <= 300) {
                    createSheep();
                } else {
                    console.log("世界归于静止...");
                }
            }, 3500);
        }

        function playSound() {
            // 音量随计数衰减
            if (realCount > 100) {
                jumpSound.volume = Math.max(0.01, 0.15 - (realCount - 100) * 0.0008);
            }
            jumpSound.currentTime = 0;
            jumpSound.play().catch(() => {}); // 捕获未交互导致的播放失败
        }

        function applyDecayEffects() {
            counterEl.innerText = displayCount;

            // 200次后栅栏淡出
            if (realCount >= 200) {
                fenceEl.style.opacity = Math.max(0, 0.5 - (realCount - 200) / 150);
            }

            // 120次后数字下沉与变淡
            if (realCount >= 120) {
                const sinkOffset = Math.min(20, (realCount - 120) * 0.15);
                counterEl.style.top = (35 + sinkOffset) + '%';
                counterEl.style.opacity = Math.max(0.01, 0.08 - (realCount - 120) / 1200);
            }
        }

        // 交互：点击暂停/继续
        world.onclick = () => {
            isPaused = !isPaused;
            
            // 数据监测：暂停/继续事件
            if (typeof gtag === 'function') {
                gtag('event', isPaused ? 'pause' : 'resume', { 'count': realCount });
            }

            const elements = document.querySelectorAll('.sheep-container, .sheep-image');
            elements.forEach(el => {
                el.style.animationPlayState = isPaused ? 'paused' : 'running';
            });
            
            if (!isPaused && document.querySelectorAll('.sheep-container').length === 0) {
                createSheep();
            }
        };

        window.onload = createSheep;
    </script>
</body>
</html>
